{"id":"lethe","script":"//* TITLE Hermes **//\n//* VERSION 1.2.0 **//\n//* DESCRIPTION Helps speed up your Tumblr experience **//\n//* DEVELOPER new-xkit **//\n//* FRAME false **//\n//* BETA true **//\n\n\n/** Export Lethe */\nXKit.extensions.lethe = new Lethe();\n\nfunction Lethe() {\n  this.TOP_CUTOFF = -500;\n  this.running = false;\n  this.scrollWaiting = false;\n  this.hiddenPosts = [];\n  this.preferences = {\n    'sep0': {\n      text: 'Options',\n      type: 'separator'\n    }\n  };\n\n}\n\n/**\n * Run Lethe\n */\nLethe.prototype.run = function() {\n  if (!XKit.interface.where().dashboard) {\n    return;\n  }\n  this.running = true;\n  this.handleScroll = this.handleScroll.bind(this);\n  window.addEventListener('scroll', this.handleScroll, false);\n};\n\n/**\n * Handle a scroll event, throttling to once every 100ms\n */\nLethe.prototype.handleScroll = function() {\n  if (this.scrollWaiting) {\n    return;\n  }\n  this.scrollWaiting = true;\n  setTimeout(this.updatePosts.bind(this), 100);\n};\n\n/**\n * Update the list of tracked posts, removing ones that are above/outside the\n * viewport and adding ones that are inside or below the viewport.\n */\nLethe.prototype.updatePosts = function() {\n  this.scrollWaiting = false;\n\n  var postMedias = document.querySelectorAll('.post_media');\n  var i;\n  for (i = 0; i < postMedias.length; i++) {\n    var postMedia = postMedias[i];\n    if (postMedia.querySelector('.playing')) {\n      continue;\n    }\n    var rect = postMedia.getBoundingClientRect();\n\n    if (rect.bottom > this.TOP_CUTOFF) {\n      // Rect is fully on screen, we want to keep it\n      break;\n    }\n    this.hidePost(postMedia);\n  }\n\n  for (i = this.hiddenPosts.length - 1; i > -1; i--) {\n    var hiddenMedia = this.hiddenPosts[i];\n    if (hiddenMedia.absoluteBottom < window.scrollY + this.TOP_CUTOFF) {\n      // hiddenMedia is higher than the current viewport\n      // all other posts should also be higher\n      break;\n    }\n    this.showPost(hiddenMedia);\n  }\n};\n\n/**\n * Hide a post, storing it for later\n * @param {DOMElement} post\n */\nLethe.prototype.hidePost = function(post) {\n  var rect = post.getBoundingClientRect();\n  var placeholder = document.createElement('div');\n  placeholder.classList.add('post_media');\n  placeholder.classList.add('post_media_hidden');\n  placeholder.style.width = rect.width + 'px';\n  placeholder.style.height = rect.height + 'px';\n\n  var parentNode = post.parentNode;\n  parentNode.replaceChild(placeholder, post);\n\n  var absoluteBottom = rect.bottom + window.scrollY;\n\n  this.hiddenPosts.push({\n    absoluteBottom: absoluteBottom,\n    html: post.outerHTML,\n    parent: parentNode\n  });\n};\n\n/**\n * Show a post, removing it from hidden posts\n * @param {DOMElement} hiddenPost\n */\nLethe.prototype.showPost = function(hiddenPost) {\n  // Overly conservative removal logic\n  this.hiddenPosts = this.hiddenPosts.filter(function(post) {\n    return post !== hiddenPost;\n  });\n  hiddenPost.parent.innerHTML = hiddenPost.html;\n};\n\n\n\n/**\n * Destroy Lethe\n */\nLethe.prototype.destroy = function() {\n  if (!this.running) {\n    return;\n  }\n  this.running = false;\n  window.removeEventListener('scroll', this.handleScroll, false);\n};\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAVFBMVEU1RlxCUmZOXXFbaXtndIRodYV0f490gI+Ai5mBjJqNl6OOl6Saoq2ao66mrrenrrizucK0usLAxczAxszM0dbN0dfZ3ODa3eHm6Ovy8/Xz9PX///9tjhPfAAACYElEQVR4AdXVb5eqLBQF8H0gKkLGHP+AnO//PZ9FUuoTht7e3Pt70VozK3Zb8SD+IfL0TiISAjsozugRqbFC2bAdgMD+igLDHwIMcylCjJ8C0HCMuBE2dfwxACZwdFfIs1wIgGj5wf9IvLvw5wBdAVA9PzNOWJNjIUDwoGJOz8n4exV4oYELAaiZ72JukYqcKRWoXSmAPPNYxQhRB54NzxDyhZsoA3NqgUvLSQoRsWIhICXw7xkA6NIsegSC5Lxg8SL9eh+ladN/7MYcsDeERBJAzat0JTFx8Wsbj5HXqyf9BoBs4GS832JI7KBBY2H5Yx+9ihHG8az7iZ+UG0RLWCPH3F3x2EfPS82jx1ov8EaEeR6FbuY1l/dBMMiRaR7PqZLStp2uoOYVJ5FHjie/NznPsPv/HjaETdpxMnbV+SRiQA0q1U8UxY/m/XoVL2hsMmMVI0i3vKSg+SVIbKPwPNHoUrtFgC2vXxxbvhKvTWimTbDl9Yl+nQGYxL8wB2iUKD8/xNVJyhSwe/1ympJFQINdyHpO1jfREfaStcsESOyirjRtpO1DCkizhLL0Br3HjIhUbGKh0lAWzS+QrpoO8/4xC9h/DxXPxm6a4z6dJyP2aHnhAj0t7A9cg+dZPf22gD3wHEiejSSHxy+nKyPsYXg2cNScfpZHSVHDWzz2cbxFoyydra1WX1QgQwB8sUJBnatA2E9whkVBaTtG8W2FDgcYzjA4oOcMif3I8buBjiSE4wk7OtxxALW5BMIBJnx5FRBNJkHiCJWJqHCIMI7XgsFBQjfPl5XvrcKfUhJ/n/8A/NSgVpmYw+UAAAAASUVORK5CYII=\n","title":"Hermes","description":"Helps speed up your Tumblr experience","developer":"new-xkit","version":"1.2.0","frame":"false","beta":"true","slow":"false"}