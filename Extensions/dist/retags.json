{"id":"retags","script":"//* TITLE       Retags **//\n//* DEVELOPER   new-xkit **//\n//* VERSION     1.0.1 **//\n//* DESCRIPTION Adds tags to reblog notes **//\n//* FRAME       false **//\n//* SLOW        false **//\n//* BETA        false **//\n\nXKit.extensions.retags = {\n\trunning: false,\n\tapi_key: '3DFxEZm0tGISOmdvWe9Fl1QsQMo1LFqEatnc8GQ68wgF1YTZ4w',\n\tselectors: '.type_2,.type_8,.reblog,.is_reblog,.notification_reblog,.is_reply,.is_answer,.is_user_mention,.notification_user_mention',\n\tblog_name: \"\",\n\n\trun: function(){\n\t\tthis.running = true;\n\t\tXKit.tools.init_css(\"retags\");\n\t\ttry {\n\t\t\tthis.blog_name = $('body').data('new-root').split('/').pop();\n\t\t} catch(e) {}\n\t\tthis.add_toggle();\n\t\tthis.observer.observe($('body')[0],{childList:true,subtree:true});\n\t\tthis.tag(this.selectors);\n\t},\n\n\tobserver: new MutationObserver(function(ms){\n\t\tms.forEach(function(m){\n\t\t\tif ($(m.addedNodes).find('.note').length > 0) {\n\t\t\t\tXKit.extensions.retags.tag($(m.addedNodes).find('.note').filter(XKit.extensions.retags.selectors));\n\t\t\t} else {\n\t\t\t\tXKit.extensions.retags.tag($(m.addedNodes).filter(XKit.extensions.retags.selectors));\n\t\t\t}\n\t\t});\n\t}),\n\n\tadd_toggle: function(){\n\t\tvar toggle = 'retags_toggle_'+this.blog_name;\n\t\tif (XKit.browser().mobile) {\n\t\t\tthis.html_toggle.appendTo('.primary-nav');\n\t\t\tXKit.tools.add_css('label.retags .binary_switch_label {font-size:15px; color:white; padding-bottom:15px; }','retags_mobile_label');\n\t\t} else {\n\t\t\tthis.html_toggle.appendTo('.ui_notes_switcher .part-toggle');\n\t\t}\n\t\t$('#retags-toggle').change(function(){\n\t\t\tif ($(this).prop('checked')) {\n\t\t\t\tlocalStorage.setItem(toggle,'true');\n\t\t\t\tXKit.extensions.retags.css_toggle.appendTo('head');\n\t\t\t\tif (XKit.browser().mobile) {\n\t\t\t\t\tXKit.extensions.retags.mobile_toggle.appendTo('head');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalStorage.setItem(toggle,'false');\n\t\t\t\tXKit.extensions.retags.css_toggle.detach();\n\t\t\t}\n\t\t});\n\t\tif (localStorage.getItem(toggle) === 'true') {\n\t\t\t$('#retags-toggle').click();\n\t\t}\n\t},\n\n\ttag: function(el){\n\t\t$(el).each(function(){\n\t\t\tvar $t = $(this), cls, $c, url;\n\t\t\tif ($t.find('div.retags').length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// popover\n\t\t\tif ($t.hasClass('note')) {\n\t\t\t\tcls = 'with_commentary';\n\t\t\t\t$c = $t;\n\t\t\t\turl = $c.find('.action').data('post-url');\n\t\t\t// Activity\n\t\t\t} else if ($t.hasClass('ui_note')) {\n\t\t\t\tif ($t.find('.part_response').length) {\n\t\t\t\t\t$t.addClass('is_response');\n\t\t\t\t}\n\t\t\t\tcls = 'is_retags';\n\t\t\t\t$c = $t.find('.stage');\n\t\t\t\turl = $c.find('.part_glass').attr('href');\n\t\t\t// dashboard\n\t\t\t} else if ($t.hasClass('notification') && !XKit.browser().mobile) {\n\t\t\t\t$c = $t.find('.notification_sentence');\n\t\t\t\turl = $c.find('.notification_target').attr('href');\n\t\t\t// mobile\n\t\t\t} else if ($t.hasClass('notification') && XKit.browser().mobile) {\n\t\t\t\tcls = 'is_retags';\n\t\t\t\t$c = $t.find('.notification-wrapper');\n\t\t\t\turl = $c.find('a').not('.notification-username').attr('href');\n\t\t\t}\n\t\t\t//we don't need to put tags on a reply, but we also don't need to hide it\n\t\t\tif ($t.hasClass('is_reply') || $t.hasClass('is_answer')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (url) {\n\t\t\t\turl = url.split('/');\n\t\t\t\tvar host = url[2], id = url[4], cache = 'retags_'+id;\n\t\t\t\tif (localStorage.getItem(cache) !== null) {\n\t\t\t\t\tXKit.extensions.retags.append($t,cls,$c,JSON.parse(localStorage.getItem(cache)));\n\t\t\t\t} else {\n\t\t\t\t\tXKit.extensions.retags.request($t,cls,$c,cache,'https://api.tumblr.com/v2/blog/'+host+'/posts/info?id='+id+'&api_key='+XKit.extensions.retags.api_key);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trequest: function($t,cls,$c,cache,url) {\n\t\tGM_xmlhttpRequest({\n\t\t\tmethod: 'GET',\n\t\t\turl: url,\n\t\t\tonload: function(data){\n\t\t\t\tvar tags = JSON.parse(data.responseText).response.posts[0].tags;\n\t\t\t\tlocalStorage.setItem(cache,JSON.stringify(tags));\n\t\t\t\tXKit.extensions.retags.append($t,cls,$c,tags);\n\t\t\t},\n\t\t\tonerror: function(data){\n\t\t\t\tXKit.extensions.retags.append($t,cls,$c,'ERROR: '+data.status);\n\t\t\t}\n\t\t});\n\t},\n\n\tappend: function($t,cls,$c,tags){\n\t\tif (tags.length) {\n\t\t\tvar $retags = $('<div class=\"retags\">');\n\t\t\tif (typeof tags === 'string') {\n\t\t\t\t$retags.append(tags).addClass('error');\n\t\t\t} else {\n\t\t\t\ttags.forEach(function(tag){\n\t\t\t\t\t$retags.append('<a href=\"//tumblr.com/tagged/'+tag.replace(/ /g,'-')+'\">#'+tag+'</a>');\n\t\t\t\t});\n\t\t\t}\n\t\t\t$t.addClass(cls);\n\t\t\t$c.append($retags);\n\t\t}\n\t},\n\n\tcss_toggle:\n\t$('<style class=\"retags\"> ' +\n\t\t'.ui_note { display: none; } ' +\n\t\t'.ui_note.is_retags, .ui_note.is_response, .ui_note.is_user_mention { display: block; } ' +\n\t'</style>'),\n\t\n\n\tmobile_toggle:\n\t$('<style class=\"retags\">' +\n\t\t'.note, .mh_post.post.post_type_notification.notification { display: none; } ' +\n\t\t'.note.with_commentary, .mh_post.post.post_type_notification.notification.is_retags { display: block; }' +\n\t'</style>'),\n\n\thtml_toggle:\n\t$('<label class=\"retags binary_switch\">'+\n\t\t'<input id=\"retags-toggle\" type=\"checkbox\">'+\n\t\t'<span class=\"binary_switch_track\"></span>'+\n\t\t'<span class=\"binary_switch_button\"></span>'+\n\t\t'<span class=\"binary_switch_label\">Show only retags / responses</span>'+\n\t'</label>'),\n\n\tdestroy: function(){\n\t\tthis.running = false;\n\t\tXKit.tools.remove_css(\"retags\");\n\t\tXKit.tools.remove_css('retags_mobile');\n\t\tthis.css_toggle.detach();\n\t\tthis.html_toggle.detach();\n\t\tthis.mobile_toggle.detach();\n\t\tthis.observer.disconnect();\n\t\t$('.retags').remove();\n\t\t$('body').off('.retags');\n\t}\n};\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDA5QTFGNzNEOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDA5QTFGNzREOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMDlBMUY3MUQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMDlBMUY3MkQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpAlVCQAAAVxSURBVHja7Fp7bFNVGP/d29LHxgZ7m73kpRKjqP9ojAmwIEYFQYn/zUQji8ZHopigxgQFQggiOBOYomhiovuDDCMxIWqMMZj4py+CL/Zoe1v2hjHZuq5bW8937+2aQe+95z7aroaTk5umPff7ft/7O+dUOONJoZiHG2JR4y92+MwCgoDrLlRYAdzFLkCxu5CA/2kM3BuEq8wiUel9SLsK7UKW0bPR/Dy8DejeXsxZqG4rmGq623JfyFgdyDodkGELbv4YWvSdmrmtA7Vb6Nn9bE5dyJVbE5MMzJeeWxh1YPwXBPZi8mcZ2VNY8RpcizlkeCSHMrgFbguM/4o/ttEH5ZWRzxA9hzu+5LPDZnr2vJiLblRE9nnNCO67es3k7xg+ze1Lm7GqA5rsrE4TFoiexbWLx75H7SZuGTZR3uh5qUAulHWlr8kcv5qHKR56dxTChWpasyyraDHNsuYhrGwvhAstewXRv8mR5kbjDpTfaUVtTAbmS70785tGXaW4vROj3+DSD/A1YOlai+iVUf0gPXtftR8DbtOMFd72B9ER0fd6MW8pqx+gZ98beclCOZUhsKs4LZCRQUDgzbzEQK5k2Eh5KbCnmDf1VffLvrTX7IZGRNY5/FVhZFj+FrQgZZ2aFgi3U+Kv2pB3GTakG0f7MRA6QCJWthRABsY3uN+JLBQ8QM/8y6BwVLjbrQOhdyjHVa43phUfxpWzmPgTi29VI9KuDAJCB50oZNJhWYZ1emv6P8fwifQm4Ttc/BpNL8PfZE+G9cRXOmStnZ4/pXdx6Uc93Q93zVsf7UHkQyd8aR2ad+oBE357zMQVk381vHXZf7p8hp4VG1G2hqSFTLV0DVbtdkCMoS8w2KnlQmZaidh5mtn3awqdGVTch1QckQ55F3oOPbvR2AZfoy0BfMuhhZMqgYMzOavGX8ML6jdsDxQ+bgv9lITwUU2Oeq2EfwVq2Dbcq/qD4Ugl4KlO5/IWIhw5Tu9OncfYT2QZK+jD6NuD5BS0cOoVsrrHUX6XrTwoeBA5JvtStxUBGPrAPiTj0AGpZwH7jaqnStVcfNQ8+ggC+5HQ1r2JdjqVxPQQUtNGt7JJOmmc86LJf+imQ6Ffutoc+lgEwbeRnDZWom47nf5pZgx9zJQxY8bl96D5GRl9N6QOJCaJiHsJKteaQX8BgYNIRMHT6nNVYiWFca2UWUb7EP6ABFZeSc3AXW4CffBQ5l2Ogy0BelMeE3+RFxmslKerhBAw9Ez3Ygn8K+lLFoWsQeJFfzite76pFwOKDlgHMdQlG4Gj5MXCkI4RAtFD9YtFTkxSbcI6PIN3+xFq5/J73krMflLQUxTehPhFzF42IDd9QTarGze0ouw2yoMKfZfPGL30noze5CGDXgyMfoupXrJDyS2ofwKhIxCucBGtfRRL71ZDQqWvCys2AOmInO/Nn/HobWimAsTYvwwNT0L0ITXL++cW9komj4nzElp29EdJ99YOeAyykK8JjU9TaDIGzK3FRVx5IQM3bQEtx5gepIhPWdK9sQW89aR75RZMWITG7dTtcKTSTC3LOI+QHT2LeMu6Nw7ipjY6mJgLaE+NaerKyYem7j+i6i7YOxrUs0B8BP5Se81QUtXuVZmRoWeNqk3dGwvQ30nJx3+j2g6xjE5xzHmSJ2L2X9rjK/QVIhn0nyARd+b/bnpBnJzBwAmSwVdP7cBAl9zbmPUimT6rIb4GGf0QIp8SZadOxQ3OhRIxWYZWeGspC1Fza21Tewqz47SfHjxF+d7BI3G3aKSJZBRDJ1G3jUqBOGGd01j6UEN09EaCa1PPlDdy2oGMkYvBe8GhbqkWoABCsf/tsuB3ZHlyoQVsgesuVNjxnwADACKdjtGZRJ7nAAAAAElFTkSuQmCC","css":".ui_notes .date_header .part_full_date.stuck {\n\tmargin-left: 400px;\n\twidth: 165px;\n}\n\nlabel.retags {\n\tmargin-left: 15px;\n\ttop: -1px;\n}\nlabel.retags .binary_switch_label {\n\tposition: absolute;\n\ttop: 0; left: 24px;\n\tpadding: 0 8px;\n\tline-height: 14px;\n\twhite-space: nowrap;\n}\n\ndiv.retags {\n\twhite-space: normal;\n\tmargin-top: 10px;\n}\n\ndiv.retags.error {\n\tcolor: #c00000;\n}\n\ndiv.retags + div.retags:before {\n\tcolor: #c00000;\n\tcontent: \"Warning: You are running multiple copies of Retags.\";\n}\n\ndiv.retags + div.retags a {\n\tdisplay: none;\n}\n\ndiv.retags a {\n\tcolor: #a7a7a7 !important;\n\tposition: relative;\n\tmargin-right: 11px;\n\ttext-decoration: none;\n}\n\ndiv.retags a:hover {\n\tcolor: #969696 !important;\n}\n\n.note div.retags {\n\tfont-size: 12px;\n\tline-height: 1.3;\n}\n\n.note div.retags a {\n\tmargin-right: 9px;\n}\n\n.post_notes .notes_outer_container.popover .note.with_commentary span.action {\n\tmin-height: 0;\n}\n\n.notification div.retags a {\n\tcolor: rgba(255,255,255,0.3) !important;\n}\n\n.notification div.retags a:hover {\n\tcolor: rgba(255,255,255,0.4) !important;\n}\n\n.ui_note div.retags {\n\tmargin-top: 0;\n\tpadding: 40px 50px 13px;\n}\n\n.ui_note div.retags + div.retags {\n\tmargin-top: -5px;\n\tpadding-top: 0;\n}\n\n.ui_note .part_response + div.retags {\n\tmargin-top: -7px;\n\tpadding-top: 0;\n}\n\ndiv.retags a:after {\n\tcontent: \"\\\\00a0  \";\n\tfont-size: 0;\n\tline-height: 0;\n}\n","title":"Retags","description":"Adds tags to reblog notes","developer":"new-xkit","version":"1.0.1","frame":"false","beta":"false","slow":"false","file":"found","server":"up","errors":false}